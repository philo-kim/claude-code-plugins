# DDD Project Configuration
# Generated by /ddd analyze
# Customize this file to match your project structure

# ============================================================================
# PROJECT INFORMATION
# ============================================================================

project: my-project
version: 1.0.0
description: Project description

# Detected or specified language/framework
language: typescript  # typescript | java | kotlin | python | go | csharp
framework: nestjs     # nestjs | express | spring | ktor | django | fastapi

# Architecture style
architecture: layered  # layered | hexagonal | clean | onion

# ============================================================================
# PATH CONFIGURATION
# ============================================================================

paths:
  # Domain layer - pure business logic
  domain: src/domain

  # Application layer - use cases and orchestration
  application: src/application

  # Infrastructure layer - technical implementations
  infrastructure: src/infrastructure

  # Shared definitions (glossary, context map)
  shared: shared

# ============================================================================
# BOUNDED CONTEXTS
# ============================================================================

bounded_contexts:
  # Example context definition
  - name: Order
    path: src/domain/order
    description: Handles customer orders and order lifecycle
    team: order-team

    aggregates:
      - name: Order
        root: src/domain/order/Order.ts
        entities:
          - src/domain/order/OrderItem.ts
        value_objects:
          - src/domain/order/OrderId.ts
          - src/domain/order/OrderStatus.ts
        events:
          - src/domain/order/events/OrderCreated.ts
          - src/domain/order/events/OrderCancelled.ts
        repository: src/domain/order/OrderRepository.ts

  # Add more contexts as needed
  # - name: Payment
  #   path: src/domain/payment
  #   ...

# ============================================================================
# CONTEXT RELATIONSHIPS
# ============================================================================

context_map:
  # Define relationships between contexts
  relationships:
    - upstream: Product
      downstream: Order
      type: customer-supplier  # shared-kernel | customer-supplier | conformist | acl | ohs

    - upstream: ExternalPaymentGateway
      downstream: Payment
      type: acl
      adapter: src/infrastructure/adapters/PaymentGatewayAdapter.ts

# ============================================================================
# HEALTH CHECK CONFIGURATION
# ============================================================================

health:
  # Thresholds for health checks
  thresholds:
    # Aggregate design
    aggregate_max_entities: 3
    aggregate_root_max_lines: 500

    # Transaction Script / God Class detection
    service_max_lines: 300
    service_max_methods: 15

    # Domain event coverage
    event_coverage_min: 50  # percentage

    # Anemic model detection
    min_business_methods: 2
    max_getter_setter_ratio: 0.5  # getters+setters / total methods

  # Scoring weights (must sum to 100)
  weights:
    anemic_model: 20
    transaction_script: 20
    aggregate_health: 15
    layer_architecture: 20
    domain_events: 10
    context_isolation: 10
    naming_consistency: 5

  # Paths to ignore in health checks
  ignore:
    - "**/test/**"
    - "**/tests/**"
    - "**/__tests__/**"
    - "**/spec/**"
    - "**/migrations/**"
    - "**/generated/**"
    - "**/node_modules/**"
    - "**/dist/**"
    - "**/build/**"

  # Custom rules
  custom_rules:
    - name: no-sql-in-domain
      description: Domain should not contain raw SQL
      pattern: "SELECT|INSERT|UPDATE|DELETE"
      paths:
        - src/domain/**
      severity: critical

    - name: no-console-in-domain
      description: Domain should not use console
      pattern: "console\\.(log|error|warn)"
      paths:
        - src/domain/**
      severity: warning

# ============================================================================
# VALIDATION RULES
# ============================================================================

validation:
  # Enable/disable specific validation rules
  rules:
    aggregate_invariants: true
    entity_identity: true
    value_object_immutability: true
    repository_location: true
    domain_service_stateless: true
    reference_by_identity: true
    single_aggregate_transaction: true
    domain_event_structure: true
    anti_corruption_layer: true
    no_framework_in_domain: true

  # Treat warnings as errors
  strict: false

# ============================================================================
# GLOSSARY CONFIGURATION
# ============================================================================

glossary:
  path: shared/glossary.yaml

  # Auto-sync settings
  auto_sync: true
  sync_on_analyze: true

  # Naming conventions
  naming:
    # Require glossary terms to be used
    enforce_terms: true

    # Allow abbreviations defined in glossary
    allow_abbreviations: true

# ============================================================================
# REPORTING
# ============================================================================

reports:
  # Where to store health reports
  output_dir: shared/health-reports

  # How many reports to keep
  keep_history: 30  # days

  # Report format
  format: markdown  # markdown | json | html

# ============================================================================
# AGENTS CONFIGURATION
# ============================================================================

agents:
  health_monitor:
    # When to run
    schedule: manual  # manual | on-commit | daily | weekly

    # Alert settings
    alerts:
      critical_threshold: 60
      degradation_threshold: 10
      notify: false  # Set to email/slack webhook if needed

  refactor_advisor:
    # Interaction mode
    mode: interactive  # interactive | batch

    # Safety settings
    safety:
      require_tests: true
      max_files_per_step: 3
      require_confirmation: true

# ============================================================================
# METADATA
# ============================================================================

metadata:
  created_at: null  # Set by /ddd analyze
  last_analyzed: null
  last_health_check: null
  last_health_score: null
